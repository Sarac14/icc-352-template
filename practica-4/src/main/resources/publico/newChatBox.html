<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <title>Chat Box</title>
    <link rel="stylesheet" href="css/main.css" />
    <script src="js/jquery-3.2.1.min.js"></script>


</head>
<body>
<noscript>
    <h2>Sorry! Your browser doesn't support Javascript</h2>
</noscript>

<div id="username-page">
    <div class="username-page-container">
        <h1 class="title">Escribe tu nombre para continuar</h1>
        <form id="usernameForm" name="usernameForm">
            <div class="form-group">
                <input type="text" id="name" placeholder="Username" autocomplete="off" class="form-control" />
            </div>
            <div class="form-group">
                <button type="submit" class="accent username-submit">Inicia la conversacion!</button>
            </div>
        </form>
    </div>
</div>

<div id="chat-page" class="hidden">
    <div class="chat-container">
        <div class="chat-header">
            <h2>Chat Box</h2>
        </div>
        <div id="mensajeServidor">
        <div class="connecting">
            Connecting...
        </div>
        <ul id="messageArea">

        </ul>
        </div>
        <form id="messageForm" name="messageForm">
            <div class="form-group">
                <div class="input-group clearfix">
                    <input type="text" id="mensajeCliente" name="mensajeCliente" placeholder="Type a message..." autocomplete="off" class="form-control"/>
                    <button type="submit" class="primary" id="boton">Send</button>
                </div>
            </div>
        </form>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.1.4/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    //abriendo el objeto para el websocket
    var webSocket;
    var tiempoReconectar = 5000;



    $(document).ready(function(){
        console.info("Iniciando Jquery -  Ejemplo WebServices");

        conectar();

        $("#boton").click(function(){
            webSocket.send($("#mensajeCliente").val());
        });
    });

    /**
     *
     * @param mensaje
     */
    function recibirInformacionServidor(mensaje){
        console.log("Recibiendo del servidor: "+mensaje.data)
        $("#mensajeServidor").append(mensaje.data);
    }

    function conectar() {
        webSocket = new WebSocket("ws://" + location.hostname + ":" + location.port + "/mensajeServidor");

        //indicando los eventos:
        webSocket.onmessage = function(data){recibirInformacionServidor(data);};
        webSocket.onopen  = function(e){ console.log("Conectado - status "+this.readyState); };
        webSocket.onclose = function(e){
            console.log("Desconectado - status "+this.readyState);
        };
    }

    function verificarConexion(){
        if(!webSocket || webSocket.readyState == 3){
            conectar();
        }
    }

    setInterval(verificarConexion, tiempoReconectar); //para reconectar.

</script>


</body>
</html>
